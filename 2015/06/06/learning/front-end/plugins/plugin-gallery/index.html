<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 自定义组件三之画廊组件 · TuzK1ss' Home</title><meta name="description" content="自定义组件三之画廊组件 - Tuzk1ss"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/tuzkiss" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/resume.html" target="_self" class="nav-list-link">RESUME</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">自定义组件三之画廊组件</h1><div class="post-info"><span class="post-date">Jun 6, 2015</span><span class="post-tag">#Javascript</span><span class="post-tag">#Plugins</span></div><div class="post-content"><p>现在是北京时间的2015年6月6日22:37:32，耳边循环着的是douban的某个频道。</p>
<p>最近因为项目中需要用到一个画廊图片展示，就抽空写了个简易的画廊组件。</p>
<p>这次使用jquery作为基础类库，基于此开发的这个WEB组件。稍微做了些可以自定义的兼容，DEMO图片如下图。<a href="https://tuzkiss.github.io/web_app/js_animation/BatmanyGallery/index.html" target="_blank" rel="external">具体DEMO地址请猛击！</a></p>
<p><img src="https://tuzkiss.github.io/images/blog/galleryDemo.png" alt="画廊demo图片"></p>
<p><strong>该组件的大致开发思想为：用户传入画廊容器的ID，以及一些可选属性。然后根据元素填充大小，实现满容器的图片切换功能，之后根据容器中图片的数量创建包含等量数量的导航条，可以通过click 或 hover 事件触发手动切换画廊图片。以及添加了一个摧毁该画廊的方法。</strong></p>
<p>首先定义一个构造函数，包括定义该gallery的version和author，以及一些默认的参数。包括动画持续时间，动画间隔（演示），父元素ID，手动切换方式。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">function BatmanGallery()&#123;</div><div class="line">    this.version = &apos;1.0.0&apos;;</div><div class="line">    this.author = &apos;tuzkiss&apos;;</div><div class="line"></div><div class="line">    this.defalutConfig = &#123;</div><div class="line">        // 动画持续时间</div><div class="line">        duration : 1000,</div><div class="line"></div><div class="line">        // 动画延时</div><div class="line">        delay : 5000,</div><div class="line"></div><div class="line">        // 相册容器ID</div><div class="line">        parentId: &apos;body&apos;,</div><div class="line"></div><div class="line">        // 切换方式click / hover</div><div class="line">        eventStyle: &apos;click&apos;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>然后在该构造函数的原型链上拓展方法：</p>
<p>··· </p>
<p># </p>
<p>BatmanGallery.prototype = {</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div></pre></td><td class="code"><pre><div class="line">index : 0,</div><div class="line">length: 0,</div><div class="line">domId : &apos;body&apos;,</div><div class="line">liWidth : 0,</div><div class="line">delay : 5000,</div><div class="line">duration : 1000,</div><div class="line">animation : null,</div><div class="line">isStarted : false,</div><div class="line">isAnimation: false,</div><div class="line">eventStyle: &apos;clcik&apos;,</div><div class="line">init: function (config) &#123;</div><div class="line"></div><div class="line">    // 混合参数</div><div class="line">    var CFG = $.extend(&#123;&#125;,this.defalutConfig, config);</div><div class="line">    this.domId = CFG.parentId;</div><div class="line">    this.duration = CFG.duration;</div><div class="line">    this.delay = CFG.delay;</div><div class="line">    this.eventStyle = CFG.eventStyle;</div><div class="line"></div><div class="line">    this.initLayout().initLength().bindNavMove().bindGalleryMove();    </div><div class="line"></div><div class="line">    return this;</div><div class="line">&#125;,</div><div class="line"></div><div class="line">// 初始化布局</div><div class="line">initLayout: function () &#123;</div><div class="line">    var parentWidth = $(&apos;#&apos; + this.domId).width(),</div><div class="line">        parentHeight = $(&apos;#&apos; + this.domId).height();</div><div class="line"></div><div class="line">    this.liWidth = parentWidth;</div><div class="line">    $(&apos;#&apos; + this.domId).find(&apos;ul &gt; li &gt; img&apos;).css(&apos;height&apos;, parentHeight);</div><div class="line"></div><div class="line">    return this;</div><div class="line">&#125;,</div><div class="line"></div><div class="line">// 初始化相册长度</div><div class="line">initLength:function () &#123;</div><div class="line">    this.length = $(&apos;#&apos; + this.domId + &apos; &gt; ul&gt;li&apos;).length;</div><div class="line"></div><div class="line">    if (this.length) &#123;</div><div class="line">        this.createNav(this.domId);</div><div class="line">    &#125;</div><div class="line">    return this;</div><div class="line">&#125;,</div><div class="line"></div><div class="line">// 创建导航nav</div><div class="line">createNav:function () &#123;</div><div class="line"></div><div class="line">    $(&apos;#&apos; + this.domId + &apos;Nav&apos;).remove();</div><div class="line"></div><div class="line">    var nav = &apos;&apos;;</div><div class="line">    nav += &apos;&lt;div id=&quot;&apos; + this.domId + &apos;Nav&quot; class=&quot;gallery-nav&quot;&gt;&lt;ul&gt;&apos;;</div><div class="line">    nav += &apos;&lt;li class=&quot;active&quot;&gt;&apos; + 0 + &apos;&lt;/li&gt;&apos;;</div><div class="line">    for (var i = 1; i &lt; this.length; i ++) &#123;</div><div class="line">        nav += &apos;&lt;li&gt;&apos; + i + &apos;&lt;/li&gt;&apos;;</div><div class="line">    &#125;</div><div class="line">    nav += &apos;&lt;/ul&gt;&lt;/div&gt;&apos;;</div><div class="line"></div><div class="line"></div><div class="line">    $(&apos;#&apos; + this.domId).find(&apos;ul&apos;).append(nav);</div><div class="line"></div><div class="line">    return this;</div><div class="line">&#125;,</div><div class="line"></div><div class="line">// 绑定相册切换</div><div class="line">bindNavMove: function () &#123;</div><div class="line">    var that = this;</div><div class="line"></div><div class="line">    if (this.eventStyle === &apos;click&apos;) &#123;</div><div class="line">        $(&apos;#&apos; + this.domId + &apos;Nav&apos;).find(&apos;li&apos;).unbind().click(function ()&#123;</div><div class="line">            var $this = $(this);</div><div class="line">            if (!$this.hasClass(&apos;active&apos;)) &#123;</div><div class="line"></div><div class="line">                that.index = $this.html();</div><div class="line">                that.isStarted = false;</div><div class="line">                that.bindGalleryMove();</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125; else if (this.eventStyle === &apos;hover&apos;) &#123;</div><div class="line">        $(&apos;#&apos; + this.domId + &apos;Nav&apos;).find(&apos;li&apos;).unbind().hover(function ()&#123;</div><div class="line">            var $this = $(this);</div><div class="line">            if (!$this.hasClass(&apos;active&apos;)) &#123;</div><div class="line"></div><div class="line">                that.index = $this.html();</div><div class="line">                that.isStarted = false;</div><div class="line">                that.bindGalleryMove();</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    return this;</div><div class="line">&#125;,</div><div class="line"></div><div class="line">// 绑定默认切换</div><div class="line">bindGalleryMove: function () &#123;</div><div class="line">    var that = this;</div><div class="line">    if (!this.isStarted) &#123;</div><div class="line">        this.galleryMove();</div><div class="line">        this.isStarted = true;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    // 清除定时器</div><div class="line">    clearInterval(BATMAN_GALLERY_ANIMATION);</div><div class="line">    BATMAN_GALLERY_ANIMATION = null;</div><div class="line"></div><div class="line">    // 重置定时器</div><div class="line">    BATMAN_GALLERY_ANIMATION = setInterval(function ()&#123;</div><div class="line">        that.galleryMove();</div><div class="line">    &#125;, this.delay);</div><div class="line">&#125;,</div><div class="line"></div><div class="line">// 相册切换方法</div><div class="line">galleryMove: function () &#123;</div><div class="line">    if (this.isAnimation) &#123;</div><div class="line">        return null;</div><div class="line">    &#125; else &#123;</div><div class="line">        var that = this,</div><div class="line">            $nav = $(&apos;#&apos; + that.domId + &apos;Nav&gt;ul&apos;),</div><div class="line">            marginLeft;</div><div class="line"></div><div class="line">        this.isAnimation = true;</div><div class="line"></div><div class="line">        if (this.index &lt;= this.length - 1) &#123;</div><div class="line">            marginLeft = &apos;-&apos; + (this.index * this.liWidth) + &apos;px&apos;;</div><div class="line">        &#125; else &#123;</div><div class="line">            marginLeft = 0;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">        $nav.find(&apos;.active&apos;).removeClass(&apos;active&apos;);</div><div class="line">        $nav.find(&apos;li&apos;).eq(that.index).addClass(&apos;active&apos;);</div><div class="line"></div><div class="line">        // 切换</div><div class="line">        $(&apos;#&apos; + this.domId +  &apos;&gt;ul&apos;).animate(&#123;</div><div class="line">            marginLeft:marginLeft</div><div class="line">        &#125;, this.durations, function () &#123;</div><div class="line"></div><div class="line">            that.isAnimation = false;</div><div class="line"></div><div class="line">            if (that.index &lt; that.length - 1) &#123;</div><div class="line">                that.index ++;</div><div class="line">            &#125; else &#123;</div><div class="line">                 that.index = 0;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">        &#125;); </div><div class="line"></div><div class="line">        return this;</div><div class="line">    &#125;</div><div class="line">&#125;,</div><div class="line"></div><div class="line">// 摧毁相册</div><div class="line">destroy: function () &#123;</div><div class="line">    this.index = 0;</div><div class="line">    this.isStarted = false;</div><div class="line">    this.isAnimation = false;</div><div class="line"></div><div class="line">    clearInterval(BATMAN_GALLERY_ANIMATION);</div><div class="line">    BATMAN_GALLERY_ANIMATION = null;</div><div class="line"></div><div class="line">    $(&apos;#&apos; + this.domId + &apos; &gt; ul&apos;).css(&apos;marginLeft&apos;, &apos;0&apos;);</div><div class="line">    $(&apos;#&apos; + this.domId + &apos;Nav&apos;).remove();</div><div class="line"></div><div class="line">    return this;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>}<br>···</p>
<p>通过init函数初始化该gallery，需要传入自定义config对象，包含必须对象parentId（未判断，下次改进）。主要函数为：创建自动切换动画，和创建手动切换导航。</p>
<p>具体调用方法为:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">new BatmanGallery().init(&#123;</div><div class="line">        parentId: &apos;gallery&apos;,</div><div class="line">        delay : 5000,</div><div class="line">        duration : 1000,</div><div class="line">        eventStyle: &apos;click&apos;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p><a href="https://tuzkiss.github.io/web_app/js_animation/BatmanyGallery/index.html" target="_blank" rel="external">具体DEMO地址请猛击！</a></p>
</div></article></div></main><footer><div class="paginator"><a href="/2015/06/11/learning/front-end/css/learning-css-center-style/" class="prev">PREV</a><a href="/2015/05/28/learning/front-end/javascripts/learning-closure/" class="next">NEXT</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'tuzkiss';
var disqus_identifier = '2015/06/06/learning/front-end/plugins/plugin-gallery/';
var disqus_title = '自定义组件三之画廊组件';
var disqus_url = 'http://www.tuzkiss.com/2015/06/06/learning/front-end/plugins/plugin-gallery/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//tuzkiss.disqus.com/count.js" async></script><div class="copyright"><p>Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/tuzkiss/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p><p>© 2015 - 2017 <a href="http://www.tuzkiss.com">Tuzk1ss</a></p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>