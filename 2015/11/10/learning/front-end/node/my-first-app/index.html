<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> NODE 学习1 · TuzK1ss' Home</title><meta name="description" content="NODE 学习1 - Tuzk1ss"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://www.tuzkiss.com/atom.xml" title="TuzK1ss' Home"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/tuzkiss" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/tuzkiss" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/resume.html" target="_self" class="nav-list-link">RESUME</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">NODE 学习1</h1><div class="post-info">Nov 10, 2015</div><div class="post-content"><p>链接 mongodb</p>
<h3 id="1-首先启动mongodb"><a href="#1-首先启动mongodb" class="headerlink" title="1.首先启动mongodb"></a>1.首先启动mongodb</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mongod</div></pre></td></tr></table></figure>
<h3 id="2-安装mongoose-module-同时引入到app-js-中"><a href="#2-安装mongoose-module-同时引入到app-js-中" class="headerlink" title="2.安装mongoose module, 同时引入到app.js 中"></a>2.安装mongoose module, 同时引入到app.js 中</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm install mongoose</div></pre></td></tr></table></figure>
<p>在app.js 中添加</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">var mongoose = require(&apos;mongoose&apos;);</div><div class="line">.</div><div class="line">.</div><div class="line">.</div><div class="line">mongoose.connect(&apos;mongodb://localhost/demo20151107&apos;);</div></pre></td></tr></table></figure>
<h3 id="3-在项目中新建两个新文件夹-models-存放数据库对象-schemas-数据架构-ps-其实是这个是看别人的视频中学到的-现在还不知道做什么用"><a href="#3-在项目中新建两个新文件夹-models-存放数据库对象-schemas-数据架构-ps-其实是这个是看别人的视频中学到的-现在还不知道做什么用" class="headerlink" title="3.在项目中新建两个新文件夹, models (存放数据库对象), schemas(数据架构?) ps.其实是这个是看别人的视频中学到的,现在还不知道做什么用"></a>3.在项目中新建两个新文件夹, models (存放数据库对象), schemas(数据架构?) ps.其实是这个是看别人的视频中学到的,现在还不知道做什么用</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mkdir models schemas</div></pre></td></tr></table></figure>
<h3 id="4-创建user类和数据库操作方法"><a href="#4-创建user类和数据库操作方法" class="headerlink" title="4.创建user类和数据库操作方法"></a>4.创建user类和数据库操作方法</h3><p>在schemas中添加user.js, </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">// 引入mongoose module</div><div class="line">var mongoose = require(&apos;mongoose&apos;);</div><div class="line"></div><div class="line">// 新建user schema</div><div class="line">var UserSchemas = new mongoose.Schema(&#123;</div><div class="line">    account : String,</div><div class="line">    password : String,</div><div class="line">    registerDate : Date,</div><div class="line">    loginCount : Number,</div><div class="line">    lastLoginDate : Date,</div><div class="line">    accountType : Number</div><div class="line">&#125;);</div><div class="line"></div><div class="line">// user schemas statics function</div><div class="line">UserSchemas.statics = &#123;</div><div class="line">    fetch : function (cb) &#123;</div><div class="line">        return this</div><div class="line">            .find(&#123;&#125;)</div><div class="line">            .exec(cb);</div><div class="line">    &#125;,</div><div class="line">    findById : function (id, cb) &#123;</div><div class="line">        return this</div><div class="line">            .findOne(&#123;_id : id&#125;)</div><div class="line">            .exec(cb)</div><div class="line">    &#125;,</div><div class="line">    findByAccount : function (account, cb) &#123;</div><div class="line">        return this</div><div class="line">            .findOne(&#123;account : account&#125;)</div><div class="line">            .exec(cb)</div><div class="line">    &#125;,</div><div class="line">    deleteByAccount : function (account, cb) &#123;</div><div class="line">        return this</div><div class="line">            .remove(&#123;account : account&#125;)</div><div class="line">            .exec(cb);</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">// module export</div><div class="line">module.exports = UserSchemas;</div></pre></td></tr></table></figure>
<p>同时在models中创建user.js</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">var mongoose = require(&apos;mongoose&apos;);</div><div class="line">var UserSchemas = require(&apos;../schemas/user&apos;);</div><div class="line">var User = mongoose.model(&apos;User&apos;, UserSchemas);</div><div class="line"></div><div class="line">module.exports = User;</div></pre></td></tr></table></figure>
<p>models中的user.js的作用是主要把之前创建的user对象转换成数据库模型</p>
<h3 id="5-需要在app-js-中引入"><a href="#5-需要在app-js-中引入" class="headerlink" title="5.需要在app.js 中引入"></a>5.需要在app.js 中引入</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">var User = require(&apos;./models/user&apos;);</div></pre></td></tr></table></figure>
<p>这样就可以在后面使用User的增删改查方法了.</p>
<h3 id="6-在app-js中创建新增add路由"><a href="#6-在app-js中创建新增add路由" class="headerlink" title="6.在app.js中创建新增add路由"></a>6.在app.js中创建新增add路由</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">app.post(&apos;/add&apos;, function (req, res) &#123;</div><div class="line">    var param = req.body;</div><div class="line"></div><div class="line">    var user = new User(&#123;</div><div class="line">        account : param.account,</div><div class="line">        password : param.password,</div><div class="line">        registerDate : new Date()</div><div class="line">    &#125;);</div><div class="line"></div><div class="line">    user.save(function (err, user) &#123;</div><div class="line">        if (err) &#123;</div><div class="line">            console.log(err);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        if (user)&#123;</div><div class="line">            res.json(&#123;status: &apos;success&apos;, data : &#123; user : user &#125;&#125;);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">    &#125;)</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h3 id="7-在app-js中新增-delete路由"><a href="#7-在app-js中新增-delete路由" class="headerlink" title="7.在app.js中新增 delete路由"></a>7.在app.js中新增 delete路由</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">app.post(&apos;/delete&apos;, function (req, res) &#123;</div><div class="line">    var param = req.body;</div><div class="line"></div><div class="line">    User.deleteByAccount(param.account, function (err, user) &#123;</div><div class="line">        if (err) &#123;</div><div class="line">           console.log(err);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        if (user) &#123;</div><div class="line">            res.json(&#123;status : &apos;success&apos;&#125;);</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h3 id="8-在app-js中新增-modify路由"><a href="#8-在app-js中新增-modify路由" class="headerlink" title="8.在app.js中新增 modify路由"></a>8.在app.js中新增 modify路由</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">app.post(&apos;/modifyPassword&apos;, function (req, res) &#123;</div><div class="line">   var param = req.body;</div><div class="line"></div><div class="line">    User.findByAccount(param.account, function (err, user) &#123;</div><div class="line">        if (err) &#123;</div><div class="line">            console.log(err);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        if (user &amp;&amp; user.account === param.account) &#123;</div><div class="line">            user.password = param.password;</div><div class="line"></div><div class="line">            user.save(function (err, nuser) &#123;</div><div class="line">                if(err) &#123;</div><div class="line">                    console.log(err);</div><div class="line">                &#125;</div><div class="line"></div><div class="line">                if (nuser) &#123;</div><div class="line">                    res.json(&#123;status : &apos;success&apos;&#125;);</div><div class="line">                &#125;</div><div class="line">            &#125;)</div><div class="line">        &#125;</div><div class="line"></div><div class="line">    &#125;)</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h3 id="9-在app-js中使用查询功能-分为全部查询和单个查询"><a href="#9-在app-js中使用查询功能-分为全部查询和单个查询" class="headerlink" title="9.在app.js中使用查询功能,分为全部查询和单个查询"></a>9.在app.js中使用查询功能,分为全部查询和单个查询</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">app.get(&apos;/list&apos;, function (req, res) &#123;</div><div class="line">    User.fetch(function (err, users) &#123;</div><div class="line">        if (err)  &#123;</div><div class="line">            console.log(err);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        res.render(&apos;list&apos;, &#123;</div><div class="line">            users : users</div><div class="line">        &#125;);</div><div class="line">    &#125;);</div><div class="line">&#125;);</div><div class="line"></div><div class="line"></div><div class="line">app.post(&apos;/checkLogin&apos;, function (req, res) &#123;</div><div class="line">   var param = req.body;</div><div class="line"></div><div class="line">    User.findByAccount(param.account, function (err, user) &#123;</div><div class="line">        if(err) &#123;</div><div class="line">            console.log(err);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        if (user) &#123;</div><div class="line">            console.log(user);</div><div class="line"></div><div class="line">            if (user.password === param.password) &#123;</div><div class="line">                res.json(&#123;status : &apos;success&apos;&#125;);</div><div class="line">            &#125; else &#123;</div><div class="line">                res.json(&#123;status : &apos;fail&apos;&#125;);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line"></div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h4 id="最后在index-js中绑定按钮使用ajax去调用这些POST请求-既可以简单的实现增删改查"><a href="#最后在index-js中绑定按钮使用ajax去调用这些POST请求-既可以简单的实现增删改查" class="headerlink" title="最后在index.js中绑定按钮使用ajax去调用这些POST请求, 既可以简单的实现增删改查.."></a>最后在index.js中绑定按钮使用ajax去调用这些POST请求, 既可以简单的实现增删改查..</h4><p>附上 index.js 代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div></pre></td><td class="code"><pre><div class="line">var index = &#123;</div><div class="line">    init : function () &#123;</div><div class="line">        console.log(&apos;index init...&apos;);</div><div class="line"></div><div class="line">        this.registerUser()</div><div class="line">            .checkSignIn()</div><div class="line">            .modifyPassword()</div><div class="line">            .deleteUser()</div><div class="line">    &#125;,</div><div class="line">    registerUser : function () &#123;</div><div class="line"></div><div class="line">        var that = this;</div><div class="line"></div><div class="line">        $(&apos;#register&apos;).on(&apos;click&apos;, function (e) &#123;</div><div class="line">            e.preventDefault();</div><div class="line"></div><div class="line"></div><div class="line">            that.ajax(&apos;/add&apos;, function (res) &#123;</div><div class="line">                console.log(res);</div><div class="line"></div><div class="line">                if (res.status === &apos;success&apos;) &#123;</div><div class="line">                    alert(&apos;注册成功&apos;);</div><div class="line">                &#125;</div><div class="line">            &#125;);</div><div class="line"></div><div class="line">        &#125;);</div><div class="line"></div><div class="line">        return this;</div><div class="line">    &#125;,</div><div class="line">    checkSignIn : function () &#123;</div><div class="line"></div><div class="line">        var that = this;</div><div class="line"></div><div class="line">        $(&apos;#sign_in&apos;).on(&apos;click&apos;, function (e) &#123;</div><div class="line"></div><div class="line">            e.preventDefault();</div><div class="line"></div><div class="line">            that.ajax(&apos;/checkLogin&apos;, function (res) &#123;</div><div class="line">                console.log(res);</div><div class="line"></div><div class="line">                if(res.status === &apos;success&apos;) &#123;</div><div class="line">                    location.href = &apos;/list&apos;</div><div class="line">                &#125;</div><div class="line">            &#125;);</div><div class="line"></div><div class="line">        &#125;);</div><div class="line"></div><div class="line">        return this;</div><div class="line">    &#125;,</div><div class="line">    modifyPassword : function () &#123;</div><div class="line">        var that = this;</div><div class="line"></div><div class="line">        $(&apos;#modify&apos;).on(&apos;click&apos;, function (e) &#123;</div><div class="line">            e.preventDefault();</div><div class="line"></div><div class="line">            that.ajax(&apos;/modifyPassword&apos;, function (res) &#123;</div><div class="line">                console.log(res);</div><div class="line"></div><div class="line">                if (res.status === &apos;success&apos;) &#123;</div><div class="line">                    alert(&apos;modify success&apos;);</div><div class="line">                &#125;</div><div class="line">            &#125;)</div><div class="line">        &#125;);</div><div class="line"></div><div class="line">        return this;</div><div class="line">    &#125;,</div><div class="line">    deleteUser : function () &#123;</div><div class="line">        var that = this;</div><div class="line"></div><div class="line">        $(&apos;#delete&apos;).on(&apos;click&apos;, function (e) &#123;</div><div class="line">            e.preventDefault();</div><div class="line"></div><div class="line">            that.ajax(&apos;/delete&apos;, function (res) &#123;</div><div class="line">                console.log(res);</div><div class="line"></div><div class="line">                if (res.status === &apos;success&apos;) &#123;</div><div class="line">                    alert(&apos;delete success&apos;);</div><div class="line">                &#125;</div><div class="line">            &#125;)</div><div class="line">        &#125;);</div><div class="line"></div><div class="line">        return this;</div><div class="line">    &#125;,</div><div class="line"></div><div class="line">    ajax : function (url, callback) &#123;</div><div class="line"></div><div class="line">        var param = &#123;</div><div class="line">            account : $(&apos;#account&apos;).val(),</div><div class="line">            password : $(&apos;#password&apos;).val()</div><div class="line">        &#125;;</div><div class="line"></div><div class="line">        $.ajax(&#123;</div><div class="line">            type : &apos;post&apos;,</div><div class="line">            url : url,</div><div class="line">            data : param,</div><div class="line">            dataType : &apos;json&apos;</div><div class="line">        &#125;).done(callback);</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"></div><div class="line">index.init();</div></pre></td></tr></table></figure>
</div></article></div></main><footer><div class="paginator"><a href="/2015/11/12/project/build-tools/gulp-experience/" class="prev">PREV</a><a href="/2015/11/07/learning/front-end/node/start-my-first-node-app/" class="next">NEXT</a></div><div class="copyright"><p>© 2015 - 2017 <a href="http://www.tuzkiss.com">Tuzk1ss</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/tuzkiss/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>